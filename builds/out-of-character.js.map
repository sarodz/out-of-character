{"version":3,"file":"out-of-character.js","sources":["../src/isEmoji.js","../src/match.js","../src/index.js"],"sourcesContent":["// const variationSelectors = /[\\uFE00-\\uFE0F]/\nconst isVariationSelector = (num) => num >= 65024 && num <= 65039\n// const highSurrogates = /[\\uD800-\\uDBFF]/\nconst isHighSurrogate = (num) => num >= 55296 && num <= 56319\n// const lowSurrogates = /[\\uDC00-\\uDFFF]/\nconst isLowSurrogate = (num) => num >= 56320 && num <= 57343\n\n// allow invisible characters in emojis\nconst isEmoji = function (text, i) {\n  // look at code before\n  if (text[i - 1]) {\n    let code = text.charCodeAt(i - 1)\n    if (isHighSurrogate(code) || isLowSurrogate(code) || isVariationSelector(code)) {\n      return true\n    }\n  }\n  // look at code before\n  if (text[i + 1]) {\n    let code = text.charCodeAt(i + 1)\n    if (isHighSurrogate(code) || isLowSurrogate(code) || isVariationSelector(code)) {\n      return true\n    }\n  }\n\n  return false\n}\nmodule.exports = isEmoji\n","const data = require('../data/characters.json')\nconst isEmoji = require('./isEmoji')\n\n/** add spaces at the end */\nconst padStr = function (str, width) {\n  while (str.length < width) {\n    str = '0' + str\n  }\n  return str\n}\n\n// for easier look-up\nconst byCode = data.reduce((h, obj) => {\n  h[obj.code] = obj\n  return h\n}, {})\n\n// chars to create our regex with\nlet codes = data\n  .filter((obj) => obj.replaceWith !== undefined)\n  .map((obj) => {\n    return obj.code.replace(/^U\\+/, '\\\\u')\n  })\n\n// return an array of found invisible characters\nconst findAll = function (text) {\n  // console.log(codes)\n  const regEx = new RegExp(`(${codes.join('|')})`, 'g')\n  let matches = []\n  text.replace(regEx, (ch, _b, offset) => {\n    // find the code of the char we matched\n    let code = ch.charCodeAt(0)\n    let hex = code.toString(16).toUpperCase()\n    hex = `U+` + padStr(hex, 4)\n    // console.log(ch, code, hex)\n    let found = byCode[hex] || {}\n    // dont match for emoji zero-width chars\n    if (found.code === 'U+200D') {\n      // is this zero-width used in an emoji?\n      if (isEmoji(text, offset)) {\n        return ch //do nothing\n      }\n    }\n    matches.push({\n      name: found.name,\n      code: found.code,\n      offset: offset,\n      replacement: found.replaceWith || '',\n    })\n    return ch //do nothing\n  })\n  return matches\n}\nmodule.exports = findAll\n","const findAll = require('./match')\n\nmodule.exports = {\n  // find invisible or strange unicode characters in the text\n  detect: (text) => {\n    let matches = findAll(text)\n    if (matches.length > 0) {\n      return matches\n    }\n    return null\n  },\n  // remove invisible or strange unicode characters from the text\n  replace: (text) => {\n    let matches = findAll(text)\n    matches.forEach((o) => {\n      let code = o.code.replace(/^U\\+/, '\\\\u')\n      let reg = new RegExp(code, 'g')\n      text = text.replace(reg, o.replacement || '')\n    })\n    return text\n  },\n}\n"],"names":["isVariationSelector","num","isHighSurrogate","isLowSurrogate","isEmoji","text","i","code","charCodeAt","padStr","str","width","length","byCode","data","reduce","h","obj","codes","filter","replaceWith","undefined","map","replace","findAll","regEx","RegExp","join","matches","ch","_b","offset","hex","toString","toUpperCase","found","push","name","replacement","detect","forEach","o","reg"],"mappings":"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"}